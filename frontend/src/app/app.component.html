<div class="page">
 <header class="top-bar">
  <div class="title-block">
    <h1 class="gradient-title">Airport Operations Dashboard</h1>
    <p class="subtitle">Live Operational Status â€” Demo Version 1.0</p>
  </div>

  <div class="meta-block" *ngIf="kpi">
    <span class="pill airport">
      âœˆï¸ Domestic & International
    </span>
    <span class="pill timestamp">
     â± Updated at:
      <strong>{{ kpi.timestamp | date:'medium' }}</strong>
     <span class="pill-note">(auto-refresh 15s)</span>
    </span>
  </div>
 </header>

<div *ngIf="kpi && !loading && !error"
     class="status-banner"
     [ngClass]="statusLevel">
  <span class="icon">
    <ng-container [ngSwitch]="statusLevel">
      <span *ngSwitchCase="'good'">ğŸŸ¢</span>
      <span *ngSwitchCase="'warn'">ğŸŸ </span>
      <span *ngSwitchCase="'bad'">ğŸ”´</span>
    </ng-container>
  </span>
  <div>
    <span class="title">{{ statusTitle }}</span>
    <span class="details" *ngIf="statusMessages.length">
      â€” {{ statusMessages.join(' â€¢ ') }}
    </span>
  </div>
</div>

  <main class="content">
    <!-- loading state -->
    <div *ngIf="loading" class="state state-loading">
      <div class="spinner"></div>
      <p>Pulling latest KPI dataâ€¦</p>
    </div>

    <!-- error state -->
    <div *ngIf="error" class="state state-error">
      <p>âš ï¸ Unable to reach backend.</p>
      <p class="hint">Check if the Django API on port 8000 is running.</p>
    </div>

    <!-- MAIN KPI GRID (single section) -->
    <section *ngIf="kpi && !loading && !error" class="kpi-section" [class.just-updated]="justUpdated">

      <!-- Row 1: headline KPIs -->
      <div class="kpi-row">
        <div class="kpi-card kpi-primary">
          <div class="label">Total Flights</div>
          <div class="value">{{ kpi.total_flights }}</div>
          <div class="caption">Arrivals + Departures (current window)</div>
        </div>

        <div class="kpi-card">
          <div class="label">On-Time Performance</div>
          <div class="value">{{ kpi.on_time_percent }}%</div>
          <div class="trend"
               [class.good]="kpi.on_time_percent >= 90"
               [class.warn]="kpi.on_time_percent < 90">
            <span *ngIf="kpi.on_time_percent >= 90">âœ… Healthy</span>
            <span *ngIf="kpi.on_time_percent < 90">âš ï¸ At risk</span>
          </div>
        </div>

        <div class="kpi-card">
          <div class="label">Delayed Flights</div>
          <div class="value">{{ kpi.delayed_percent }}%</div>
          <div class="caption">Share of flights with delay</div>
        </div>
      </div>

      <!-- Row 2: resource utilization -->
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="label">Active Stands</div>
          <div class="value">{{ kpi.active_stands }}</div>
          <div class="caption">Occupied / in-turnaround</div>
        </div>

        <div class="kpi-card">
          <div class="label">Belts in Use</div>
          <div class="value">{{ kpi.baggage_belts_in_use }}</div>
          <div class="caption">Baggage reclaim load</div>
        </div>

        <div class="kpi-card">
          <div class="label">Security Queue</div>
          <div class="value">{{ kpi.security_queue_avg_minutes }} mins</div>
          <div class="caption">Average wait at security</div>
        </div>
      </div>

      <!-- Row 3: traffic volume -->
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="label">Arrivals (last hour)</div>
          <div class="value">{{ kpi.arrivals_last_hour }}</div>
          <div class="caption">Inbound flights handled</div>
        </div>

        <div class="kpi-card">
          <div class="label">Departures (last hour)</div>
          <div class="value">{{ kpi.departures_last_hour }}</div>
          <div class="caption">Outbound flights handled</div>
        </div>

        <div class="kpi-card">
          <div class="label">Runway Occupancy</div>
          <div class="value">{{ kpi.runway_occupancy_percent }}%</div>
          <div class="caption">Runway usage (all runways)</div>
        </div>
      </div>

      <!-- Row 4: turnaround + weather -->
      <div class="kpi-row">
        <div class="kpi-card">
          <div class="label">Average Turnaround</div>
          <div class="value">{{ kpi.average_turnaround_minutes }} mins</div>
          <div class="caption">Gate in â†’ gate out</div>
        </div>

        <div class="kpi-card">
          <div class="label">Weather</div>
          <div class="value">{{ kpi.weather_condition }}</div>
          <div class="caption">
            {{ kpi.temperature_c }}&deg;C at field
          </div>
        </div>

        <!-- empty slot to keep grid layout -->
        <div class="kpi-card" style="opacity: 0; pointer-events: none;"></div>
      </div>
    </section>

    <!-- Chart section -->
    <app-performance-chart></app-performance-chart>
  </main>
</div>
