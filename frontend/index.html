<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AWS CI/CD Demo</title>
</head>
<body onload="checkStatus()">
  <h1>AWS CI/CD Demo Frontend</h1>

  <p>Status: <span id="status">Not checked</span></p>

  <div>
    <label>
      Name:
      <input id="nameInput" type="text" value="Suren" />
    </label>
    <button id="helloBtn">Say Hello</button>
  </div>

  <p>Response: <span id="response"></span></p>

  <script>
    const statusSpan = document.getElementById("status");
    const responseSpan = document.getElementById("response");
    const nameInput = document.getElementById("nameInput");
    const helloBtn = document.getElementById("helloBtn");

    // Backend base URL = same host as frontend, port 8000
    const BACKEND_BASE = `http://${window.location.hostname}:8000`;

    // Debug line: this alone should overwrite "Not checked" if JS runs at all
    statusSpan.textContent = "JS loaded, checking backend...";

    async function checkStatus() {
      try {
        const res = await fetch(`${BACKEND_BASE}/`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        statusSpan.textContent = data.message || JSON.stringify(data);
      } catch (err) {
        statusSpan.textContent = "Error talking to backend";
        console.error("Status check failed:", err);
      }
    }

    async function sayHello() {
      const name = encodeURIComponent(nameInput.value || "Suren");
      try {
        const res = await fetch(`${BACKEND_BASE}/hello?name=${name}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        responseSpan.textContent = data.message || JSON.stringify(data);
      } catch (err) {
        responseSpan.textContent = "Error";
        console.error("Hello request failed:", err);
      }
    }

    helloBtn.addEventListener("click", sayHello);
  </script>
</body>
</html>
